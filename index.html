
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>QA Smart Panel + D-Line Generator</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f8fb;
      display: flex;
      height: 100vh;
	   font-size: 13px;

    }
    .sidebar {
  width: 220px;
  min-width: 220px;     
  max-width: 220px;     
  background: #2c3e50;
  color: white;
  display: flex;
  flex-direction: column;
  padding: 20px 10px;
  overflow-y: auto;      
  overflow-x: hidden;    
  flex-shrink: 0;        
}
	
    .sidebar h2 {
      font-size: 16px;
      margin-bottom: 20px;
      padding-left: 10px;
    }
    .sidebar a {
  padding: 8px 15px;
  margin: 4px 0;
  text-decoration: none;
  color: white;
  border-radius: 6px;
  display: block;
  font-size: 13px;
  white-space: nowrap;       
  overflow: hidden;           
  text-overflow: ellipsis;    
}
    .sidebar a:hover, .sidebar a.active {
      background-color: #3498db;
    }
    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    textarea, input[type="date"], input[type="text"], select {
      width: 100%;
      padding: 6px;
      margin: 6px 0 10px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 6px 12px;
      margin: 3px;
      font-size: 13px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    h3 {
      margin-top: 0;
      font-size: 16px;
    }
    .card-content {
      display: none;
    }
    .card-content.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
	   font-size: 13px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #3498db;
      color: white;
	   font-size: 12px;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
	  font-size: 13px;
    }
    .row label {
      width: 120px;
      font-weight: bold;
    }
    .row input, .row select {
      flex: 1;
    }
	
	input.small-date {
	width: 150px;
	}
	textarea.large-output {
  min-height: 200px;
  font-family: monospace;
  white-space: pre;
	}
	textarea.medium-output {
  min-height: 100px;
  font-family: monospace;
  white-space: pre;
	}
	
    .small-input {
  width: 20px;
  max-width: 15%;
  padding: 4px 8px;
  font-size: 13px;
}

   .noometal-brand {
  position: fixed;
  bottom: 8px;
  left: 12px;
  font-size: 11px;
  font-family: 'Segoe UI', sans-serif;
  color: rgba(0, 206, 209, 0.3);           /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏ó‡∏∞‡πÄ‡∏•‡∏à‡∏≤‡∏á‡πÜ */
  letter-spacing: 1px;
  text-shadow: 0 0 2px rgba(0, 206, 209, 0.15); /* ‡πÄ‡∏á‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏ó‡∏∞‡πÄ‡∏• */
  pointer-events: none;
  z-index: 999;
  user-select: none;
}

 /* Toggle Switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      margin-right: 10px;
      vertical-align: middle;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4CAF50;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .toggle-label {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
	
	.small-select_id_card {
  width: 200px;   /* ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏ä‡πâ 150px ‡∏Å‡πá‡πÑ‡∏î‡πâ */
  max-width: 100%;
}

#scrollx_ClaimpayWHT {
  overflow-x: auto;
  padding-bottom: 8px;
}

#wht-table_ClaimpayWHT {
  min-width: 2400px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
  border-collapse: collapse;
  width: 100%;
}

#wht-table_ClaimpayWHT th,
#wht-table_ClaimpayWHT td {
  font-size: 13px;
  min-width: 120px;     /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á */
  padding: 10px 8px;    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
  text-align: center;
}

#wht-table_ClaimpayWHT input[type="text"] {
  width: 100%;
  min-width: 90px;
  max-width: 180px;  /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ä‡πà‡∏≠‡∏á input */
  padding: 7px 11px;
  font-size: 14px;
  border-radius: 7px;
  border: 1px solid #b3d2ee;
  background: #fcfcfc;
  margin: 2px 0;
  box-sizing: border-box;
}

#wht-table_ClaimpayWHT tr:hover td {
  background: #eaf5fc;
}



  </style>
</head>
<body>
  <div class="sidebar">
    <h2>üß† QA Micro App ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô</h2>
    <a href="#" class="tab-link active" onclick="switchTab('sql')">üì¶ Gen : Query ‡∏õ‡∏µ‡∏ï‡πà‡∏≠ ORD AS400</a>
    <a href="#" class="tab-link" onclick="switchTab('mapping')">üì¶ Gen : Ref_1</a>
	<a href="#" class="tab-link" onclick="switchTab('idcardno')"> üì¶ Gen : ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</a>
    <a href="#" class="tab-link" onclick="switchTab('dline')">üì¶ Gen : Text File Counter Bank</a>
	<a href="#" class="tab-link" onclick="switchTab('split_text')">üì¶ ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</a>
	<a href="#" class="tab-link" onclick="switchTab('json_gen')">üì¶ Gen : JSON For Test Data</a>
	<a href="#" class="tab-link" onclick="switchTab('google_gen')">üì¶ Google Sheets : Formula Generator</a>
	<a href="#" class="tab-link" onclick="switchTab('claimpay_wht')">üì¶ Claim-payment : WHT Export</a>
  </div>

  <div class="main-content">
<div id="sql" class="card-content active">

      <div class="section">
        <h3>üìÑ SQL Query Generator ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô AS400</h3>
       <div style="display: flex; align-items: left ; gap: 15px;">
	   
	   
  <button onclick="useToday()">üìÖ ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ </button> <p>‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏á</p>
  <input type="date" id="customDate" class="small-date">
</div>
<br>
        <div><strong>üìÜ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏:</strong> <span id="displayDate"></span></div>
		
        <textarea id="sqlOutput"  class="large-output"></textarea>
		<div class="section">
        <button onclick="copySQL()">üìã Copy</button>
        <button onclick="clearSQL()">üßπ Clear</button>
		</div>
		<script>
    function pad(n) {
      return n.toString().padStart(2, '0');
    }

    function toYYMMDD(date) {
      const d = new Date(date);
      const year = d.getFullYear() - 543;
      const yy = (year ).toString().padStart(2, '0');
      const mm = pad(d.getMonth() + 1);
      const dd = pad(d.getDate());
      return { yy, mm, dd };
    }
	
	function toBEYYMMDD(dateObj) {
  const year = dateObj.getFullYear() + 543 - 2500;
  return `${pad(year)}${pad(dateObj.getMonth() + 1)}${pad(dateObj.getDate())}`;
}



    function formatThaiDate(date) {
  const d = new Date(date);
  const year = d.getFullYear() + 543;
  const month = ('0' + (d.getMonth() + 1)).slice(-2); // ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 2 ‡∏´‡∏•‡∏±‡∏Å
  const day = ('0' + d.getDate()).slice(-2);          // ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 2 ‡∏´‡∏•‡∏±‡∏Å
  return `${year}/${month}/${day}`;
}

  function generateSQL(dateInput) {
  const base = new Date(dateInput);

  function toBEYYMMDD(dateObj) {
    const year = String(dateObj.getFullYear() + 543 - 2500).padStart(2, '0');
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    const day = String(dateObj.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
  }

  const end = toBEYYMMDD(base);

  const mod1Start = new Date(base.getFullYear(), base.getMonth() - 2, base.getDate() - 1);
  const mod1End = new Date(base.getFullYear(), base.getMonth() - 1, base.getDate() - 1);
  const mod1StartStr = toBEYYMMDD(mod1Start);
  const mod1EndStr = toBEYYMMDD(mod1End);

  const mod3StartStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 3, 1));
  const mod3EndStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 3, base.getDate()));

  const mod6StartStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 6, 1));
  const mod6EndStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 6, base.getDate()));

  const mod12StartStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 12, 1));
  const mod12EndStr = toBEYYMMDD(new Date(base.getFullYear(), base.getMonth() - 12, base.getDate()));

  const sql = `SELECT a.POLIC#, a.POSMAS, a.POCMDT, a.POFRDT,a.POTODT, a.POMOD#, a.*
FROM olis.OLPPOLMS AS a
WHERE a.POSTS@ = 'I' AND NOT EXISTS (
  SELECT 1 FROM olis.OLPLOAHD b WHERE a."POLIC#" = b."LHPOL#"
) AND (
  (a.POMOD# = '1' AND a.POTODT BETWEEN '${mod1StartStr}' AND '${mod1EndStr}') OR
  (a.POMOD# = '3' AND a.POFRDT BETWEEN '${mod3StartStr}' AND '${mod3EndStr}' AND a.POTODT <= '${end}') OR
  (a.POMOD# = '6' AND a.POFRDT BETWEEN '${mod6StartStr}' AND '${mod6EndStr}' AND a.POTODT <= '${end}') OR
  (a.POMOD# = '12' AND a.POFRDT BETWEEN '${mod12StartStr}' AND '${mod12EndStr}' AND a.POTODT <= '${end}')
);`;

  document.getElementById('sqlOutput').value = sql;
  document.getElementById('displayDate').textContent = formatThaiDate(dateInput);
}



    function useToday() {
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0];
      document.getElementById('customDate').value = dateStr;
      generateSQL(dateStr);
    }

    function copySQL() {
      const textarea = document.getElementById('sqlOutput');
      textarea.select();
      document.execCommand('copy');
    }

    function clearSQL() {
      document.getElementById('sqlOutput').value = '';
      document.getElementById('displayDate').textContent = '';
    }

    document.getElementById('customDate').addEventListener('change', function () {
      generateSQL(this.value);
    });
	</script>
      </div>
    </div>
	
	
<div id="mapping" class="card-content">
      <div class="card">
        <h3>üîß ‡πÄ‡∏•‡∏Ç‡∏Å‡∏ò Transform ‡πÄ‡∏õ‡πá‡∏ô  Ref1  </h3>
        <input type="text" id="inputID" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Å‡∏ò : 1104860, J7647226, E6350304, PAR10430199, ‡∏™1234568">
        <br><button onclick="transform()">‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤</button>
        
  <label for="output_1">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</label>
  <textarea id="output_1" readonly></textarea>
		
  <script>
    const specialPrefixes = ['PA', 'PAR'];
    const mappingTable = {
      "00": "0", "033": "PA", "034": "PAR", "03": "‡∏Å", "04": "‡∏Ç", "05": "‡∏É",
      "06": "‡∏Ñ", "07": "‡∏Ö", "08": "‡∏Ü", "09": "‡∏á", "10": "A", "11": "B", "12": "C",
      "13": "D", "14": "E", "15": "F", "16": "K", "17": "T", "18": "‡∏™", "19": "H",
      "20": "I", "21": "J", "22": "1", "23": "2", "24": "3", "25": "4", "26": "5",
      "27": "6", "28": "7", "29": "8", "30": "9"
    };

    function buildMaps() {
      const prefixMap = [];
      const charMap = {};
      for (const code in mappingTable) {
        const desc = mappingTable[code];
        if (specialPrefixes.includes(desc)) {
          prefixMap.push({ desc, code: code.padStart(3, '0') });
        } else if (desc.length >= 2) {
          prefixMap.push({ desc, code: code.padStart(2, '0') });
        } else {
          charMap[desc] = code.padStart(2, '0');
        }
      }
      prefixMap.sort((a, b) => b.desc.length - a.desc.length);
      return { prefixMap, charMap };
    }

    function transform() {
      const input = document.getElementById("inputID").value.trim();
      if (!input) {
        document.getElementById("output_1").value = "";
        return;
      }

      const { prefixMap, charMap } = buildMaps();
      let transformed = input;
      let matchedPrefix = null;

      for (const map of prefixMap) {
        if (input.startsWith(map.desc)) {
          transformed = map.code + input.slice(map.desc.length);
          matchedPrefix = map.desc;
          break;
        }
      }

      if (!matchedPrefix) {
        const firstChar = input.charAt(0);
        const rest = input.slice(1);
        const code = charMap[firstChar];
        if (code) transformed = code + rest;
      }

      document.getElementById("output_1").value = transformed;
    }
  </script>
      </div>
    </div>
	
<div id="idcardno" class="card-content">
      <div class="card">
        <h3>ìÅã Gen : ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô </h3>
		
  <div class="radio-group">
    <label><input type="radio" name="idType" value="thai" checked onchange="updatePrefixOptions()"> ‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢</label>
    <label><input type="radio" name="idType" value="alien" onchange="updatePrefixOptions()"> ‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß</label>
  </div>

  <div class="toggle-label">
    <label class="switch">
      <input type="checkbox" id="customPrefix" onchange="togglePrefixSelect()">
      <span class="slider"></span>
    </label>
    <span>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏á</span>
  </div>

  <label>‡πÄ‡∏•‡∏Ç‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤:</label>
  <select id="prefixSelect" disabled  class="small-select_id_card"></select>

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:</label>
  <select id="count" class="small-select_id_card"> >
    <option value="3">3 ‡πÄ‡∏•‡∏Ç</option>
    <option value="5" selected>5 ‡πÄ‡∏•‡∏Ç</option>
    <option value="10">10 ‡πÄ‡∏•‡∏Ç</option>
  </select>
  
<p style="font-size: 10px; color: gray; margin-left: 10px;">
  * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç 1- 5  ‡πÅ‡∏•‡∏∞ ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç 6-9  [‡πÅ‡∏ï‡πà‡πÉ‡∏ô Ocean ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß‡πÄ‡∏õ‡πá‡∏ô 0 6 7 8  ‡πÅ‡∏•‡∏∞ 9 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢]
</p>

  <div class="btn-group">
   <button onclick="generateIDCards()">üìÑ Generate</button>
    <button onclick="copyOutput_2()">üìã Copy</button>
    <button onclick="clearOutput()">üßπ Clear</button>
  </div>

  <textarea id="output_2" readonly class="large-output"></textarea>
		
  <script>
    function updatePrefixOptions() {
      const type = document.querySelector('input[name="idType"]:checked').value;
      const prefixSelect = document.getElementById('prefixSelect');
      prefixSelect.innerHTML = '';

      const start = type === 'thai' ? 1 : 6;
      const end = type === 'thai' ? 5 : 9;

      for (let i = start; i <= end; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = i;
        prefixSelect.appendChild(opt);
      }
    }

    function togglePrefixSelect() {
      const isEnabled = document.getElementById('customPrefix').checked;
      document.getElementById('prefixSelect').disabled = !isEnabled;
    }

    function generateID(type, customPrefixEnabled, customPrefix) {
      let id = '';
      if (customPrefixEnabled) {
        id += customPrefix;
      } else {
        id += (type === 'thai') ? Math.floor(Math.random() * 5) + 1 : Math.floor(Math.random() * 4) + 6;
      }

      for (let i = 0; i < 11; i++) {
        id += Math.floor(Math.random() * 10);
      }

      let sum = 0;
      for (let i = 0; i < 12; i++) {
        sum += parseInt(id.charAt(i)) * (13 - i);
      }

      let checkDigit = (11 - (sum % 11)) % 10;
      return id + checkDigit;
    }

    function generateIDCards() {
  const type = document.querySelector('input[name="idType"]:checked').value;
  const count = parseInt(document.getElementById('count').value);
  const customPrefixEnabled = document.getElementById('customPrefix').checked;
  const prefix = parseInt(document.getElementById('prefixSelect').value);
  const output_2 = [];

  for (let i = 0; i < count; i++) {
    output_2.push(generateID(type, customPrefixEnabled, prefix));
  }

  document.getElementById('output_2').value = output_2.join('\n');
}


    function copyOutput_2() {
      const textarea = document.getElementById('output_2');
      textarea.select();
      document.execCommand('copy');
      //alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!');
    }

    function clearOutput() {
      document.getElementById('output_2').value = '';
    }

    // ‡πÇ‡∏´‡∏•‡∏î prefix options ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    updatePrefixOptions();
  </script>
      </div>
    </div>
	


<div id="dline" class="card-content">
<div class="card">
<h2>üìÑ  Generator Text File - Counter Bank V.1</h2>

<div class="row">
  <label>Bank Code:</label>
  <select id="bankCommon"  class="small-input">
    <option value="002">002 BBL</option>
    <option value="004">004 KBANK</option>
    <option value="006">006 KTB</option>
    <option value="011">011 TMB</option>
	<option value="014">014 SCB</option>
	<option value="022">022 CIMB</option>
	<option value="025">025 BAY</option>
	<option value="030">030 GSB</option>
	<option value="034">034 BAAC</option>
	<option value="065">065 TNB</option>
	<option value="073">073 LH</option>

	
  </select>
</div>
<div class="row">
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</label>
  <input type="date" id="txnDate"  class="small-input" onchange="syncDates()" />
</div>

<table id="detailTable">
  <thead>
    <tr>
      <th>Effective Date</th>
      <th>Payment Date</th>
      <th>Customer Name   
	<br><span style="font-size: 11px; color: Blue;">*‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Eng	</span><br>
	<span style="font-size: 11px; color: red;">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span><br>
	
	</th>
	<p style="font-size: 10px; color: gray; margin-left: 10px;">
  * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏∏ Customer Name ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô <strong>ANSI</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Encoding ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
</p>
      <th>Ref1 
	<br>
	<span style="font-size: 11px; color: Blue;">*‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏∏</span><br>
	</th>
      <th>Ref2</th>
      <th>Amount</th>
      <th>Fee1 
	  <br>
	<span style="font-size: 11px; color: red;">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span><br>
	</th>
      <th>Fee2
	  <br>
	<span style="font-size: 11px; color: red;">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span><br></th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="addRow()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>
<button onclick="clearRows()">üßπ Clear</button>
<button onclick="generateText()">üìÑ Generate</button>
<button onclick="copyOutput()">üìã Copy</button>
<button onclick="downloadTxt()">üíæ Export</button>

<h3>üì¶ Text Output <span style="font-size: 9px; color: Blue;"> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Export ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>  </h3>

<textarea id="outputArea" readonly class="large-output"> </textarea>

<script>
function pad(str, len) {
  return (str || "").toString().padEnd(len, ' ').slice(0, len);
}

function getDDMMYYYY(dateStr) {
  const d = new Date(dateStr);
  const dd = String(d.getDate()).padStart(2, '0');
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const yyyy = String(d.getFullYear());
  return dd + mm + yyyy;
}

function addRow() {
  const tbody = document.querySelector("#detailTable tbody");
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input type="text" maxlength="8" class="eff" /></td>
    <td><input type="text" maxlength="8" class="pay" /></td>
    <td><input type="text" maxlength="50" value="QA TestFile" /></td>
    <td><input type="text" maxlength="19" value="5101020120468042275" /></td>
    <td><input type="text" maxlength="8" value="28032568" /></td>
    <td><input type="number" step="0.01" maxlength="13" value="500.00" /></td>
    <td><input type="text" maxlength="2" value="00" /></td>
    <td><input type="text" maxlength="10" value="0000000000" /></td>
    <td><button onclick="this.closest('tr').remove()">üóë</button></td>
  `;
  tbody.appendChild(tr);
  syncDates();
}

function setDefault() {
  document.querySelectorAll("#detailTable tbody tr").forEach(row => {
    const date = getDDMMYYYY(document.getElementById("txnDate").value);
    row.querySelector(".eff").value = date;
    row.querySelector(".pay").value = date;
  });
}

function clearRows() {
  document.querySelector("#detailTable tbody").innerHTML = "";
}

function syncDates() {
  const date = getDDMMYYYY(document.getElementById("txnDate").value);
  document.querySelectorAll(".eff, .pay").forEach(el => el.value = date);
}

function generateText() {
  const bank = document.getElementById("bankCommon").value;
  const bankText = document.getElementById("bankCommon").selectedOptions[0].text.split(' ')[1];
  const txnDate = getDDMMYYYY(document.getElementById("txnDate").value);
  const tbody = document.querySelector("#detailTable tbody");
  const rows = tbody.querySelectorAll("tr");

  let totalAmount = 0;
  const lines = Array.from(rows).map((row, i) => {
    const cells = row.querySelectorAll("input");
    const eff = pad(cells[0].value, 8);
    const pay = pad(cells[1].value, 8);
    const name = pad(cells[2].value, 50);
    const ref1 = pad(cells[3].value, 20);
    const ref2 = pad(cells[4].value, 39);
    const rawAmt = parseFloat(cells[5].value.replace(/[^\d.]/g, ""));
    const amt = pad(String(Math.round(rawAmt * 100)).padStart(13, '0'), 13);
    totalAmount += isNaN(rawAmt) ? 0 : rawAmt;
    const fee2 = pad(cells[7].value, 10);
    const fixID = "1473129649";
    const seq = "D" + String(i + 2).padStart(6, '0');
    const fixedValue = pad("003335", 6);
    const fixedValue_2 = pad("B0250147CMBD00000000", 20);
    const fixedValue_3 = pad("0005052020", 13);
    const fixedValue_4 = pad("00", 56);
    return seq + bank + fixID + eff + fixedValue + name + ref1 + ref2 + fixedValue_2 + amt + fixedValue_3 + fixedValue_4 + fee2;
	
	
  });

  const headerRaw = "H000001" + bank + "1473129649" + bankText.padEnd(40, ' ').slice(0, 40) + txnDate + "OCLCROSS";
  const header = headerRaw.padEnd(195, ' ').slice(0, 195);

  const dCount = rows.length;
  const trailerSeq = "T" + String(dCount + 2).padStart(6, '0');
  const dCountStr = String(dCount).padStart(6, '0');
  const TfixedValue_1 = pad("0000000000000000001", 19);
  const totalAmountStr = String(Math.round(totalAmount * 100)).padStart(13, '0');
  
  const trailerRaw = trailerSeq + bank + "1473129649" + TfixedValue_1 + totalAmountStr + dCountStr  ;
  const trailer = trailerRaw.padEnd(82, ' ').slice(0, 82);

  document.getElementById("outputArea").value = header + "\n" + lines.join("\n") + "\n" + trailer;
}

function copyOutput() {
  const txt = document.getElementById("outputArea");
  txt.select();
  document.execCommand("copy");
}

function downloadTxt() {
  const blob = new Blob([document.getElementById("outputArea").value], {type: "text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Generated_DLines.txt";
  a.click();
  URL.revokeObjectURL(url);
}

window.onload = () => {
  document.getElementById("txnDate").valueAsDate = new Date();
  addRow();
};
</script>
</div>
</div>

<div id="split_text" class="card-content">
      <div class="card">
        <h2>üîÅ ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</h2>

  <label>üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Auto Detect):</label>
  <textarea id="inputArea_5" placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô 'aaa','bbb','ccc' ‡∏´‡∏£‡∏∑‡∏≠ aaa bbb ccc"></textarea>

  <label>üîπ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏Ñ‡∏±‡πà‡∏ô Output:</label>
  <select id="outputSelect_5" onchange="toggleCustom('output')">
    <option value="\n">‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</option>
	<option value="quoted-comma">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Query ','</option>
    <option value="custom">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á</option>
  </select>
  <input type="text" id="outputCustom_5" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏Ñ‡∏±‡πà‡∏ô Output ‡πÄ‡∏≠‡∏á" style="display:none" />

  <button onclick="convertDelimiter()">üìÑ ‡πÅ‡∏õ‡∏•‡∏á</button>
  <button onclick="clearAll()">üßπ Clear</button>

  <h3>üîπ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</h3>
  <textarea id="output_5" class="large-output" readonly></textarea>

   <button onclick="copyOutput_5()">üìã Copy</button>
   
  <script>
   function toggleCustom(type) {
  const custom = document.getElementById(type + 'Custom_5');
  const select = document.getElementById(type + 'Select_5');
  custom.style.display = select.value === 'custom' ? 'block' : 'none';
}


   function getOutputDelimiter() {
  const select = document.getElementById('outputSelect_5').value.trim();
  const custom = document.getElementById('outputCustom_5').value;

  if (select === 'custom') return custom;
  
  // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á string escape ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô character ‡∏à‡∏£‡∏¥‡∏á
  if (select === '\\n') return '\n';
  if (select === '\\t') return '\t';

  // ‚úÖ return delimiter ‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏≤‡∏á ' " ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß
  if (select === 'quoted-comma') return 'quoted-comma';

  return select.replace(/^['"\s]+|['"\s]+$/g, '');
}



   function detectInputDelimiter(text) {
  const candidates = [
    { regex: /'\s*,\s*'/, label: 'quoted-comma' },
    { regex: /\s*,\s*/, label: ',' },
    { regex: /\n+/, label: 'newline' },
    { regex: /\t+/, label: 'tab' },
    { regex: /\s{2,}/, label: 'double space' },
    { regex: /\s+/, label: 'space' },
  ];

  let bestMatch = candidates[0];
  let maxParts = 0;

  candidates.forEach(c => {
    // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á replace quote ‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô split
    const cleanedText = text.replace(/^['"]+|['"]+$/g, '');
    const parts = cleanedText.split(c.regex).filter(x => x.trim() !== '');
    if (parts.length > maxParts) {
      maxParts = parts.length;
      bestMatch = c;
    }
  });

  return bestMatch.regex;
}

function convertDelimiter() {
  const inputText = document.getElementById('inputArea_5').value.trim();
  const outputDelimiter = getOutputDelimiter();

  // ‚úÖ ‡πÉ‡∏ä‡πâ match ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö universal
  const parts = inputText
    .match(/(['"]?[\w‡∏Å-‡πô]+['"]?)/g)  // ‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢ ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÄ‡∏•‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ quote
    .map(x =>
      x
        .replace(/^[\s,'"\[\]]+/, '')
        .replace(/[\s,'"\[\]]+$/, '')
        .trim()
    )
    .filter(Boolean);

  let result = '';
  if (outputDelimiter === 'quoted-comma') {
    result = parts.map(x => `'${x}'`).join(',');
  } else {
    result = parts.join(outputDelimiter);
  }

  document.getElementById('output_5').value = result;

}

function copyOutput_5() {
  const txt = document.getElementById("output_5");
  txt.select();
  document.execCommand("copy");
}


    function clearAll() {
      document.getElementById('inputArea_5').value = '';
     document.getElementById('output_5').value = '';

    }
  </script>
  </div>
</div>

<div id="json_gen" class="card-content">
      <div class="card">
        <h2>üì¶ Gen : JSON For Test Data</h2>
		
		
<div>
  <label>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: <input id="new-column-name_6" placeholder="‡πÄ‡∏ä‡πà‡∏ô Column_1" /></label>
  <button onclick="addColumn_6()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</button>
  <button onclick="addRow_6()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<table id="data-table">
  <thead>
    <tr id="header-row">
      <!-- ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    </tr>
  </thead>
  <tbody id="table-body">
    <!-- ‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  </tbody>
</table>
<label class="switch">
  <input type="checkbox" id="toggle-running_6" onchange="renderHeader_6(); renderRunningNo_6();" checked />
  <span class="slider"></span></label>
<span> ‡πÅ‡∏™‡∏î‡∏á Running No.</span>
 <button onclick="generateJSON_6()">üîÅ Generate JSON</button>
</label>
<div style="margin-top: 10px;">

<div style="margin-top: 10px;">
<h3>üìÑ JSON Output</h3>
<textarea id="json-output_6" readonly class="medium-output"></textarea><br>
<button onclick="copyJSONToClipboard_6()">üìã Copy JSON</button>

  <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: <input id="file-name_6" value="test-data" /></label>
  <label style="margin-left: 10px;">
    ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:
    <select id="file-type_6" class="small-select_id_card">
      <option value="json">.json</option>
      <option value="csv">.csv</option>
      <option value="xlsx">.xlsx</option>
    </select>
  </label>
  <button onclick="exportData_6()">üì§ Export</button>
</div>

</div>

<h3>üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ JSON</h3>
<textarea id="json-input_6" placeholder="‡∏ß‡∏≤‡∏á JSON ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤" class="medium-output"></textarea><br/>
<button onclick="importJSON_6()">üì• Import ‡∏à‡∏≤‡∏Å Text Area ‡∏ô‡∏µ‡πâ</button>



<h3>üìÇ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå JSON / CSV / XLSX</h3>
<input type="file" id="file-import_6" accept=".csv,.xlsx,.json" />
<button onclick="handleFileImport_6()">üì• Import File</button>



<script>
  const headerRow = document.getElementById('header-row');
  const tableBody = document.getElementById('table-body');
  const jsonOutput = document.getElementById('json-output_6');
  let columns = ['Value_1', 'Value_2', 'Value_3'];

  function addColumn_6() {
    const input = document.getElementById('new-column-name_6');
    const newCol = input.value.trim();
    if (!newCol) return alert('üõë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå');
    if (columns.includes(newCol)) return alert('‚ö†Ô∏è ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
    columns.push(newCol);
    renderHeader_6();
    [...tableBody.children].forEach(row => {
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'text';
      input.oninput = exportJSON_6;
      td.appendChild(input);
      row.insertBefore(td, row.lastChild);
    });
    input.value = '';
    exportJSON_6();
  }

  function renderHeader_6() {
    headerRow.innerHTML = '';
    const showRunning = document.getElementById('toggle-running_6').checked;
    if (showRunning) {
      const thNo = document.createElement('th');
      thNo.textContent = '#';
      headerRow.appendChild(thNo);
    }
    columns.forEach((col, index) => {
      const th = document.createElement('th');
      const span = document.createElement('span');
      span.textContent = col;
      th.appendChild(span);
      const editBtn = document.createElement('button');
      editBtn.textContent = '‚úèÔ∏è';
      editBtn.style.marginLeft = '6px';
      editBtn.onclick = () => editColumn_6(index);
      th.appendChild(editBtn);
      headerRow.appendChild(th);
    });
    const thDelete = document.createElement('th');
    thDelete.textContent = 'üóëÔ∏è';
    headerRow.appendChild(thDelete);
    renderRunningNo_6();
  }

  function editColumn_6(index) {
    const oldName = columns[index];
    const newName = prompt(`üîß ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "${oldName}" ‡πÄ‡∏õ‡πá‡∏ô:`, oldName);
    if (!newName || newName.trim() === '') return alert('‚ö†Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á');
    if (columns.includes(newName) && newName !== oldName) return alert('‚ö†Ô∏è ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
    columns[index] = newName.trim();
    renderHeader_6();
    exportJSON_6();
  }

  function renderRunningNo_6() {
    const showRunning = document.getElementById('toggle-running_6').checked;
    [...tableBody.children].forEach((row, index) => {
      const exist = row.querySelector('.cell-running');
      if (showRunning && !exist) {
        const td = document.createElement('td');
        td.className = 'cell-running';
        td.textContent = index + 1;
        row.insertBefore(td, row.firstChild);
      } else if (!showRunning && exist) {
        exist.remove();
      } else if (exist) {
        exist.textContent = index + 1;
      }
    });
  }

  function addRow_6(data = {}) {
    const tr = document.createElement('tr');
    const showRunning = document.getElementById('toggle-running_6').checked;
    if (showRunning) {
      const tdNo = document.createElement('td');
      tdNo.className = 'cell-running';
      tdNo.textContent = tableBody.children.length + 1;
      tr.appendChild(tdNo);
    }
    columns.forEach(col => {
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'text';
      input.value = data[col] || '';
      input.oninput = exportJSON_6;
      td.appendChild(input);
      tr.appendChild(td);
    });
    const tdDel = document.createElement('td');
    const btn = document.createElement('button');
    btn.textContent = '‡∏•‡∏ö';
    btn.onclick = () => {
      tr.remove();
      exportJSON_6();
      renderRunningNo_6();
    };
    tdDel.appendChild(btn);
    tr.appendChild(tdDel);
    tableBody.appendChild(tr);
    exportJSON_6();
  }

  function generateJSON_6() {
    const result = [];
    const showRunning = document.getElementById('toggle-running_6').checked;
    [...tableBody.children].forEach((row, index) => {
      const inputs = row.querySelectorAll('input');
      const item = {};
      if (showRunning) item.no = index + 1;
      columns.forEach((col, idx) => {
        item[col] = inputs[idx].value;
      });
      result.push(item);
    });
    jsonOutput.value = JSON.stringify(result, null, 2);
  }

  function exportJSON_6() {
    generateJSON_6();
  }

  function exportData_6() {
    generateJSON_6();
    const data = JSON.parse(jsonOutput.value);
    const fileName = document.getElementById('file-name_6').value.trim() || 'data';
    const fileType = document.getElementById('file-type_6').value;
    if (fileType === 'json') {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      downloadBlob(blob, fileName + '.json');
    } else if (fileType === 'csv') {
      const csv = jsonToCSV(data);
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      downloadBlob(blob, fileName + '.csv');
    } else if (fileType === 'xlsx') {
      exportToXLSX(data, fileName + '.xlsx');
    }
  }

  function downloadBlob(blob, fileName) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    a.click();
    URL.revokeObjectURL(url);
  }

  function exportToXLSX(jsonData, fileName) {
    const worksheet = XLSX.utils.json_to_sheet(jsonData);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
    XLSX.writeFile(workbook, fileName);
  }

  function jsonToCSV(jsonArray) {
    if (!jsonArray.length) return '';
    const keys = Object.keys(jsonArray[0]);
    const lines = jsonArray.map(obj => keys.map(k => `"${(obj[k] ?? '').toString().replace(/"/g, '""')}"`).join(','));
    return keys.join(',') + '\n' + lines.join('\n');
  }

  function handleFileImport_6() {
    const fileInput = document.getElementById('file-import_6');
    const file = fileInput.files[0];
    if (!file) return alert('üìÇ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
    const reader = new FileReader();
    const fileExt = file.name.split('.').pop().toLowerCase();
    reader.onload = function (e) {
      const content = e.target.result;
      if (fileExt === 'csv') {
        const data = CSVToJSON(content);
        processImportedData_6(data);
      } else if (fileExt === 'xlsx') {
        const workbook = XLSX.read(content, { type: 'binary' });
        const sheetName = workbook.SheetNames[0];
        const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
        processImportedData_6(jsonData);
      } else if (fileExt === 'json') {
        try {
          const jsonData = JSON.parse(content);
          processImportedData_6(jsonData);
        } catch (err) {
          alert('‚ùå ‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
      } else {
        alert('‚ùå ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .csv, .xlsx ‡πÅ‡∏•‡∏∞ .json');
      }
    };
    if (fileExt === 'xlsx') {
      reader.readAsBinaryString(file);
    } else {
      reader.readAsText(file);
    }
  }

  function CSVToJSON(csv) {
    const parsed = Papa.parse(csv, {
      header: true,
      skipEmptyLines: true,
      dynamicTyping: false,
    });
    return parsed.data;
  }

  function copyJSONToClipboard_6() {
    const textarea = document.getElementById('json-output_6');
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    document.execCommand('copy');
  }

  function processImportedData_6(data) {
    if (!Array.isArray(data)) {
      alert('‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Array');
      return;
    }
    columns = [...new Set(data.flatMap(obj => Object.keys(obj)).filter(k => k !== 'no'))];
    renderHeader_6();
    tableBody.innerHTML = '';
    data.forEach(item => addRow_6(item));
    generateJSON_6();
  }

  function importJSON_6() {
    const input = document.getElementById('json-input_6').value.trim();
    try {
      const parsed = JSON.parse(input);
      if (!Array.isArray(parsed)) throw '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà array';
      processImportedData_6(parsed);
    } catch {
      const csvLike = input.includes('\t') ? input.replace(/\t/g, ',') : input;
      const lines = csvLike.split('\n').map(l => l.trim()).filter(Boolean);
      const headers = lines[0].split(',').map(h => h.trim());
      const data = lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || '');
        return obj;
      });
      processImportedData_6(data);
    }
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  renderHeader_6();
  addRow_6();
</script>

 </div>
</div>


<div id="google_gen" class="card-content">
  <div class="card">
    <h3>üìù Google Sheets : Formula Generator</h3>


    <div class="row">
        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏π‡∏ï‡∏£:</label>
        <select id="formulaType_select_column" style="width: 100px;">
          <option value="xlookup_latest">XLOOKUP ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (FILTER+SORT)</option>
          <option value="iferror">IFERROR ‡∏£‡∏≠‡∏ö‡∏™‡∏π‡∏ï‡∏£</option>
          <option value="vlookup">VLOOKUP ‡∏õ‡∏Å‡∏ï‡∏¥</option>
        </select>
</div>
<div class="row">
        <label>‡∏ä‡∏∑‡πà‡∏≠ Tab ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</label>
        <input type="text" id="targetSheet_select_column" style="width: 100px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô TEST_SUITE">
</div>
 <div class="row">
        <label>Cell ‡∏ó‡∏µ‡πà‡∏°‡∏µ Key (target):</label>
        <input type="text" id="targetKeyCell_select_column" style="width: 150px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô C8">
</div>
 <div class="row">
        <label>‡∏ä‡∏∑‡πà‡∏≠ Tab ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (source):</label>
        <input type="text" id="sourceSheet_select_column" style="width: 150px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô upload_to_sheet">
</div>
 <div class="row">
        <label>‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (columns):</label>
        <input type="text" id="sourceCols_select_column" style="width: 150px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô A:E ‡∏´‡∏£‡∏∑‡∏≠ A-E ‡∏´‡∏£‡∏∑‡∏≠ 1-5">
</div>
 <div class="row">
        <label>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Key (source):</label>
        <input type="text" id="sourceKeyCol_select_column" style="width: 150px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô C">
</div>
 <div class="row">
        <label>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</label>
        <input type="text" id="resultColInput_select_column" style="width: 150px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô E ‡∏´‡∏£‡∏∑‡∏≠ 5">
</div>
      </div>
    

    <div class="section">
      <h4><label>üîπ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</label></h4>
      <textarea id="generatedFormula_select_column" readonly class="medium-output"></textarea><br>
      <button class="btn" onclick="copyFormula_select_column()">üìã Copy ‡∏™‡∏π‡∏ï‡∏£</button>
      <button class="btn btn-clear" onclick="clearInputs_select_column()">üßπ Clear</button>
    </div>
  

  <script>
    document.getElementById("formulaType_select_column").addEventListener("change", generateFormula_select_column);
    document.querySelectorAll("input, select").forEach(el => el.addEventListener("input", generateFormula_select_column));

    function columnLetterToNumber(col) {
      col = col.toUpperCase();
      let num = 0;
      for (let i = 0; i < col.length; i++) {
        num = num * 26 + (col.charCodeAt(i) - 64);
      }
      return num;
    }

    function numberToColumnLetter(n) {
      let result = "";
      while (n > 0) {
        const rem = (n - 1) % 26;
        result = String.fromCharCode(65 + rem) + result;
        n = Math.floor((n - 1) / 26);
      }
      return result;
    }

    function normalizeRangeInput(rangeInput) {
      if (/^[A-Z]-[A-Z]$/i.test(rangeInput)) {
        const parts = rangeInput.toUpperCase().split("-");
        return `${parts[0]}:${parts[1]}`;
      } else if (/^\d+-\d+$/.test(rangeInput)) {
        const parts = rangeInput.split("-").map(Number);
        return `${numberToColumnLetter(parts[0])}:${numberToColumnLetter(parts[1])}`;
      }
      return rangeInput;
    }

    function expandRangeIfNeeded(range, targetColLetter) {
      const match = range.match(/^([A-Z]+):([A-Z]+)$/);
      if (!match) return range;

      const startCol = match[1];
      let endCol = match[2];
      const startNum = columnLetterToNumber(startCol);
      let endNum = columnLetterToNumber(endCol);
      const targetNum = columnLetterToNumber(targetColLetter);

      if (targetNum > endNum) {
        endNum = targetNum;
        endCol = numberToColumnLetter(endNum);
        return `${startCol}:${endCol}`;
      }
      return range;
    }

    function generateFormula_select_column() {
  const type = document.getElementById("formulaType_select_column").value;
  const src = document.getElementById("sourceSheet_select_column").value.trim();
  let range = document.getElementById("sourceCols_select_column").value.trim();
  const keyCol = document.getElementById("sourceKeyCol_select_column").value.trim();
  const tgt = document.getElementById("targetSheet_select_column").value.trim();
  const keyCell = document.getElementById("targetKeyCell_select_column").value.trim();
  const resultInput = document.getElementById("resultColInput_select_column").value.trim();

  if (!(src && range && keyCol && tgt && keyCell && resultInput)) {
    document.getElementById("generatedFormula_select_column").value = "‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö";
    return;
  }

  range = normalizeRangeInput(range);
  const colLetter = isNaN(resultInput) ? resultInput : numberToColumnLetter(parseInt(resultInput));
  range = expandRangeIfNeeded(range, colLetter);
  const colIndex = isNaN(resultInput) ? columnLetterToNumber(resultInput) : parseInt(resultInput);

  let formula = "";
  if (type === "xlookup_latest") {
    formula = `=IFERROR(\n  INDEX(\n    SORT(\n      FILTER('${src}'!${range}, TRIM('${src}'!${keyCol}:${keyCol}) = TRIM(${keyCell})),\n      1, FALSE\n    ),\n    1, ${colIndex}\n  ),\n  "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"\n)`;
  } else if (type === "iferror") {
    formula = `=IFERROR(...‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...)`;
  } else if (type === "vlookup") {
    formula = `=VLOOKUP(${keyCell}, '${src}'!${range}, ${colIndex}, FALSE)`;
  }

  document.getElementById("generatedFormula_select_column").value = formula;
}


    function copyFormula_select_column() {
  const formula = document.getElementById("generatedFormula_select_column");
  formula.select(); // 
  document.execCommand("copy"); // 
 
}
    

    function clearInputs_select_column() {
      const ids = [
        "targetSheet_select_column",
        "targetKeyCell_select_column",
        "sourceSheet_select_column",
        "sourceCols_select_column",
        "sourceKeyCol_select_column",
        "resultColInput_select_column"
      ];
      ids.forEach(id => document.getElementById(id).value = "");
      document.getElementById("formulaType_select_column").selectedIndex = 0;
      document.getElementById("generatedFormula_select_column").value = "";
    }
  </script>
 </div>
 </div>
 
  
  <div id="claimpay_wht" class="card-content">
  <div class="card">
    <h2>üìù claimpay : WHT Export</h2>
  <div class="flex" id="flex_ClaimpayWHT">
    <input type="file" id="importFile_ClaimpayWHT" accept=".txt">
    <button class="btn" id="btnImport_ClaimpayWHT" onclick="importTxt_ClaimpayWHT()">Import</button>
    <button class="btn" id="btnClear_ClaimpayWHT" onclick="clearTable_ClaimpayWHT()">Clear</button>
    <button class="btn" id="btnCopyPipe_ClaimpayWHT" onclick="copyPipe_ClaimpayWHT()">Copy | (Pipe)</button>
    <button class="btn" id="btnCopyConcat_ClaimpayWHT" onclick="copyConcat_ClaimpayWHT()">Copy (Concat)</button>
  </div>

  <div class="scrollx" id="scrollx_ClaimpayWHT">
    <table id="wht-table_ClaimpayWHT">
      <thead>
        <tr>
        <th>Seq</th>
        <th>~Batch Ref No</th>
        <th>~Sub Batch Ref No</th>
        <th>~Cust Ref No</th>
        <th>~Payment Ref No</th>
        <th>~Customer Code</th>
        <th>~Debit Account No</th>
        <th>~Product Code</th>
        <th>~Payee Code</th>
        <th>~Payee Name</th>
        <th>~Payee Account No</th>
        <th>~Credit Bank Code</th>
        <th>~Bank Branch Code</th>
        <th>~Payee Charge Code</th>
        <th>~Swift Code</th>
        <th>~Processing Date</th>
        <th>~Value Date</th>
        <th>~Payment Amount</th>
        <th>~Payment Currency</th>
        <th>~Buying Rate</th>
        <th>~Selling Rate</th>
        <th>~Fix Amount Mode</th>
        <th>~Instrument No.</th>
        <th>~Status</th>
        <th>~Reason of Status</th>
        <th>~WHT</th>
        <th>~Internal ref</th>
        <th>~WHT Running No.</th>
        <th>~WHT Inc Type</th>
        <th>~WHT Rate</th>
        <th>~Inc Type Amt.</th>
        <th>~WHT Amt.</th>
        <th>~INV</th>
        <th>~Internal ref</th>
        <th>~Invoice Description</th>
        <th>~Inv Amt</th>
        <th>~VAT Amount</th>
        <th>~Invoice No.</th>
        <th>~PO No</th>
        <th>~Inv. Date</th>
      </tr>
      </thead>
      <tbody id="tbody-table_ClaimpayWHT">
        <tr>
        <!-- ‡∏ä‡πà‡∏≠‡∏á input ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô FIELD_CONFIG -->
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td class="fix-cell"><input type="text" readonly class="readonly"></td>
        <td><input type="text"></td>
        <td><input type="text"></td> <!-- ~Invoice Description -->
        <td><input type="text"></td> <!-- ~Inv Amt -->
        <td><input type="text"></td> <!-- ~VAT Amount -->
        <td><input type="text"></td>  <!-- ~Invoice No. -->
		<td><input type="text"></td>  <!-- ~PO No -->
		<td class="fix-cell"><input type="text" readonly class="readonly"></td>  <!-- ~Inv. Date -->

      </tr>
      </tbody>
    </table>
  </div>

  <div id="result_ClaimpayWHT" class="hidden"></div>
</div>
<script>
const FIELD_CONFIG_ClaimpayWHT = [
 
  // 0: Seq
  { type: "from_line",  startWith: "003~", fieldIdx: 2 },
  // 1: ~Batch Ref No
  { type: "fixed", value: "~OCEANIN008048" },
  // 2: ~Sub Batch Ref No
  { type: "fixed", value: "~1719" },
  // 3: ~Cust Ref No 
  { type: "from_line", startWith: "003~", fieldIdx: 8, prefix: "~" },
  // 4: ~Payment Ref No
  { type: "fixed", value: "~00BOCEANIN1011570" },
  // 5: ~Customer Code
  { type: "from_line", startWith: "003~", fieldIdx: 1, prefix: "~" },
  // 6: ~Debit Account No
  { type: "fixed", value: "~9250025955" },
  // 7: ~Product Code
  { type: "from_line", startWith: "003~", fieldIdx: 3, prefix: "~" },
  // 8: ~Payee Code	
  { type: "fixed", value: "~" }, // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á fix ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
  // 9: ~Payee Name
  { type: "from_line", startWith: "003~", fieldIdx: 43, prefix: "~" },
  // 10: ~Payee Account No
  { type: "from_line", startWith: "003~", fieldIdx: 4, prefix: "~" },
  // 11: ~Credit Bank Code
  { type: "from_line", startWith: "003~", fieldIdx: 37, prefix: "~" },
  // 12: ~Bank Branch Code
  { type: "fixed", value: "~0895844" },
  // 13: ~Payee Charge Code
  { type: "fixed", value: "~BEN" },
  // 14: ~Swift Code
  { type: "fixed", value: "~014" },
  // 15: ~Processing Date
  { type: "from_line", startWith: "003~", fieldIdx: 5, prefix: "~" , dateFormat: true },
  // 16: ~Value Date
  { type: "from_line", startWith: "003~", fieldIdx: 5, prefix: "~" , dateFormat: true },
  // 17: ~Payment Amount
  { type: "from_line", startWith: "003~", fieldIdx: 30, prefix: "~" , decimal: 2 },
  // 18: ~Payment Currency
  { type: "fixed", value: "~THB" },
  // 19: ~Buying Rate
  { type: "fixed", value: "~" },
  // 20: ~Selling Rate
  { type: "fixed", value: "~" },
  // 21: ~Fix Amount Mode
  { type: "fixed", value: "~C" },
  // 22: ~Instrument No.
  { type: "fixed", value: "~" },
  // 23: ~Status
  { type: "fixed", value: "~Paid" },
  // 24: ~Reason of Status
  { type: "fixed", value: "~" },
  // 25: ~WHT
  { type: "fixed", value: "~WHT1" },
  // 26: ~Internal ref
  { type: "from_line", startWith: "003~", fieldIdx: 8, prefix: "~" },
  // 27: ~WHT Running No.
  { type: "fixed", value: "~1" },
  // 28: ~WHT Inc Type
  { type: "fixed", value: "~21" },
  // 29: ~WHT Rate
  { type: "from_line", startWith: "003~", fieldIdx: 34, prefix: "~" , decimal: 2, noDivide: true },
  // 30: ~Inc Type Amt.
  { type: "from_line", startWith: "003~", fieldIdx: 30, prefix: "~" , decimal: 2 },
  // 31: ~WHT Amt.
  { type: "from_line", startWith: "003~", fieldIdx: 28, prefix: "~" , decimal: 2 },
  // 32: ~INV
  { type: "fixed", value: "~INV" },
  // 33: ~Internal ref
  { type: "from_line", startWith: "003~", fieldIdx: 8, prefix: "~" },
  // 34: ~Invoice Description
  { type: "from_line", startWith: "001~", fieldIdx: 4, prefix: "~" },
  // 35: ~Inv Amt
  { type: "from_line", startWith: "003~", fieldIdx: 30, prefix: "~" , decimal: 2 },
  // 36: ~VAT Amount
  { type: "from_line", startWith: "003~", fieldIdx: 28, prefix: "~" , decimal: 2 },
  // 37: ~Invoice No.
  { type: "from_line", startWith: "009~", fieldIdx: 1, prefix: "~" },
  // 38: ~PO No
   { type: "from_line", startWith: "003~", fieldIdx: 8, prefix: "~" },
  // 38: ~Inv. Date
  { type: "fixed", value: "~" },
];

// =========== All functions with _ClaimpayWHT suffix =============

function importTxt_ClaimpayWHT() {
  const fileInput = document.getElementById('importFile_ClaimpayWHT');
  if (!fileInput.files[0]) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå');
  const reader = new FileReader();
  reader.onload = function(e) {
    let text = e.target.result.replace(/\r/g, '');
    const lines = text.split('\n').filter(x => x.trim() !== "");

    // 1. ‡πÅ‡∏¢‡∏Å Header/Detail/Footer
    const headerLine = lines.find(line => line.startsWith("001~")) || "";
    const detailLines = lines.filter(line => /^(003|005|009)~/.test(line));

    // 2. Split blocks ‡∏ï‡∏≤‡∏° 003~
    let blocks = [];
    let curr = [];
    detailLines.forEach(line => {
      if (line.startsWith('003~') && curr.length) {
        blocks.push(curr);
        curr = [];
      }
      curr.push(line);
    });
    if (curr.length) blocks.push(curr);

    // 3. Map Data
    const tbody = document.getElementById('tbody-table_ClaimpayWHT');
    tbody.innerHTML = "";

    blocks.forEach((block, rowIdx) => {
      const tr = document.createElement('tr');
      FIELD_CONFIG_ClaimpayWHT.forEach((conf, idx) => {
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.type = "text";
        let val = "";
        if (conf.type === "fixed") {
          val = conf.value;
          if (td.classList) td.classList.add("fix-cell");
          input.classList.add("readonly");
          input.readOnly = true;
        } else if (conf.type === "from_line") {
          let line = null;
          if (conf.startWith === "001~") {
            line = headerLine;
          } else {
            line = block.find(line => line.startsWith(conf.startWith));
          }
          if (line) {
            const fields = line.split('~');
            val = fields[conf.fieldIdx] !== undefined ? fields[conf.fieldIdx].trim() : "";
            if (conf.prefix && !val.startsWith(conf.prefix)) val = conf.prefix + val;
            if (conf.dateFormat) val = conf.prefix + formatThaiDate_ClaimpayWHT(val);
            if (conf.decimal && !isNaN(Number(val.replace(conf.prefix, "")))) {
              let num = Number(val.replace(conf.prefix, ""));
              if (!conf.noDivide) num = num / 100;
              val = conf.prefix + num.toFixed(conf.decimal);
            }
          }
        }
        input.value = val;
        td.appendChild(input);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  };
  reader.readAsText(fileInput.files[0]);
}

function formatThaiDate_ClaimpayWHT(str) {
  str = str.replace(/^~/, "");
  if (str.length !== 8) return str;
  const day = str.substring(0,2);
  const month = str.substring(2,4);
  const year = str.substring(6,8);
  const monthNames = [
    '', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
  ];
  let mIdx = parseInt(month, 10);
  if (!mIdx || mIdx > 12) return str;
  return day + '-' + monthNames[mIdx] + '-' + year;
}


function clearTable_ClaimpayWHT() {
  document.getElementById('tbody-table_ClaimpayWHT').innerHTML = '';
  document.getElementById('result_ClaimpayWHT').classList.add('hidden');
  document.getElementById('result_ClaimpayWHT').innerText = '';
}

function copyPipe_ClaimpayWHT() {
  const rows = document.querySelectorAll('#tbody-table_ClaimpayWHT tr');
  let txt = Array.from(rows).map(tr =>
    Array.from(tr.querySelectorAll('td input')).map(inp => inp.value).join('|')
  ).join('\n');
  copyToClipboard_ClaimpayWHT(txt, "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Pipe (|) ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
}

function copyConcat_ClaimpayWHT() {
  const rows = document.querySelectorAll('#tbody-table_ClaimpayWHT tr');
  let txt = Array.from(rows).map(tr =>
    Array.from(tr.querySelectorAll('td input')).map(inp => inp.value).join('')
  ).join('\n');
  copyToClipboard_ClaimpayWHT(txt, "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Concat ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
}

function copyToClipboard_ClaimpayWHT(txt, msg) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(txt).then(() => {
      alert(msg);
    });
  } else {
    let textarea = document.createElement("textarea");
    textarea.value = txt;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
    alert(msg);
  }
}
</script>
   </div>
    </div>
	
  <script>
    function switchTab(tabId) {
      document.querySelectorAll('.card-content').forEach(e => e.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelectorAll('.tab-link').forEach(e => e.classList.remove('active'));
      event.target.classList.add('active');
    }
  </script>
  <div class="noometal-brand">Version Beta 1.0.6 
  <br>Power of NooMetal</div>
</body>
</html>
